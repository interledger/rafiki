import { LinkOut } from '@interledger/docs-design-system'

### Required

<div class="overflow-table wider-column">

| Variable                 | Helm value name                                                                                           | Default                                                          | Description                                                                                                                                                                                                                                                                                                                                                        |
| ------------------------ | --------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `AUTH_DATABASE_URL`      | `config.auth.databaseUrl.value` or `config.auth.databaseUrl.secretKeyRef`                                 | `postgresql://postgres:password@localhost:5432/auth_development` | The URL of the Postgres database storing your Open Payments grant data. Can be provided as a value or secret reference.                                                                                                                                                                                                                                            |
| `AUTH_SERVER_URL`        | `config.auth.authServerUrl`                                                                               | _undefined_                                                      | The public endpoint for your Rafiki instance's public Open Payments routes.                                                                                                                                                                                                                                                                                        |
| `COOKIE_KEY`             | `config.auth.cookieKey.value` or `config.auth.cookieKey.secretKeyRef`                                     | _undefined_                                                      | The <LinkOut href="https://koajs.com/#app-keys-">koa KeyGrip key</LinkOut> that is used to sign cookies for an interaction session.                                                                                                                                                                                                                                |
| `IDENTITY_SERVER_URL`    | `config.auth.identityServer.domain`                                                                       | _undefined_                                                      | The URL of your IdP's server, used by the authorization server to inform an Open Payments client of where to redirect the end-user to start interactions.                                                                                                                                                                                                          |
| `IDENTITY_SERVER_SECRET` | `config.auth.identityServer.serverSecret.value` or `config.auth.identityServer.serverSecret.secretKeyRef` | _undefined_                                                      | A shared secret between the authorization server and the IdP server; the authorization server will use the secret to secure its IdP-related endpoints.<br/>When the IdP server sends requests to the authorization server, the IdP server must provide the secret via an [`x-idp-secret`](/integration/requirements/open-payments/idp#x-idp-secret-header) header. |
| `REDIS_URL`              | `config.auth.redisUrl.value` or `config.auth.redisUrl.secretKeyRef`                                       | `redis://127.0.0.1:6379`                                         | The connection URL for Redis. Can be provided as a value or secret reference.                                                                                                                                                                                                                                                                                      |

</div>

### Conditionally required

<div class="overflow-table">

| Variable      | Helm value name          | Default | Description                                                                                                                                           |
| ------------- | ------------------------ | ------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| `TRUST_PROXY` | `config.auth.trustProxy` | `false` | Must be set to `true` when running Rafiki behind a proxy. When `true`, the `X-Forwarded-Proto` header is used to determine if connections are secure. |

</div>

### Optional

<div class="overflow-table wider-column">

| Variable                          | Helm value name                           | Default            | Description                                                                                                                                                         |
| --------------------------------- | ----------------------------------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `ACCESS_TOKEN_DELETION_DAYS`      | `config.auth.accessToken.deletionDays`    | `30`               | The days until expired and/or revoked access tokens are deleted.                                                                                                    |
| `ACCESS_TOKEN_EXPIRY_SECONDS`     | `config.auth.accessToken.expirySeconds`   | `600` (10 minutes) | The expiry time, in seconds, for access tokens.                                                                                                                     |
| `ADMIN_API_SIGNATURE_VERSION`     | _undefined_                               | `1`                | The version of the request signing algorithm used to generate signatures.                                                                                           |
| `ADMIN_API_SIGNATURE_TTL_SECONDS` | _undefined_                               | `30`               | The time to live (TTL), in seconds, for which a request's signature will be valid.                                                                                  |
| `ADMIN_PORT`                      | `config.auth.port.admin`                  | `3003`             | The port of your Rafiki Auth Admin API server.                                                                                                                      |
| `AUTH_PORT`                       | `config.auth.port.auth`                   | `3006`             | The port of your Open Payments authorization server.                                                                                                                |
| `DATABASE_CLEANUP_WORKERS`        | `config.auth.workers.cleanup`             | `1`                | The number of workers processing expired or revoked access tokens.                                                                                                  |
| `ENABLE_MANUAL_MIGRATIONS`        | _undefined_                               | `false`            | When `true`, you must run the auth Postgres database manually with the command `npm run knex – migrate:latest –envproduction`                                       |
| `INCOMING_PAYMENT_INTERACTION`    | `config.auth.interaction.incomingPayment` | `false`            | When `true`, incoming Open Payments grant requests are interactive                                                                                                  |
| `INTERACTION_EXPIRY_SECONDS`      | _undefined_                               | `600` (10 minutes) | The time, in seconds, for which a user can interact with a grant request before the request expires.                                                                |
| `INTERACTION_PORT`                | _undefined_                               | `3009`             | The port number of your Open Payments interaction-related APIs.                                                                                                     |
| `INTROSPECTION_PORT`              | `config.auth.port.introspection`          | `3007`             | The port of your Open Payments access token introspection server.                                                                                                   |
| `SERVICE_API_PORT`                | _undefined_                               | `3011`             | The port to expose the internal service api.                                                                                                                        |
| `LIST_ALL_ACCESS_INTERACTION`     | _undefined_                               | `true`             | When `true`, grant requests that include a `list-all` action will require interaction. In these requests, the client asks to list resources that it did not create. |
| `LOG_LEVEL`                       | `config.auth.logLevel`                    | `info`             | <LinkOut href="https://getpino.io/#/docs/api?id=levels">Pino log level</LinkOut>                                                                                    |
| `NODE_ENV`                        | `config.auth.nodeEnv`                     | `development`      | The type of node environment: `development`, `test`, or `production`.                                                                                               |
| `QUOTE_INTERACTION`               | `config.auth.interaction.quote`           | `false`            | When `true`, quote grants are interactive.                                                                                                                          |
| `REDIS_TLS_CA_FILE_PATH`          | _undefined_                               | `''`               | <LinkOut href="https://redis.io/docs/latest/operate/oss_and_stack/management/security/encryption/">Redis TLS config</LinkOut>                                       |
| `REDIS_TLS_CERT_FILE_PATH`        | _undefined_                               | `''`               | <LinkOut href="https://redis.io/docs/latest/oss_and_stack/management/security/encryption/">Redis TLS config</LinkOut>                                               |
| `REDIS_TLS_KEY_FILE_PATH`         | _undefined_                               | `''`               | <LinkOut href="https://redis.io/docs/latest/operate/oss_and_stack/management/security/encryption/">Redis TLS config</LinkOut>                                       |
| `WAIT_SECONDS`                    | `config.auth.grant.waitSeconds`           | `5`                | The wait time, in seconds, included in a grant request response (`grant.continue`).                                                                                 |
| `ADMIN_API_SECRET`                | _undefined_                               | _undefined_        | The secret for the auth admin API authentication.                                                                                                                   |
| `INTERACTION_COOKIE_SAME_SITE`    | `config.auth.interaction.cookieSameSite`  | _undefined_        | The SameSite attribute for interaction cookies. Valid values: `lax`, `none`.                                                                                        |

</div>
